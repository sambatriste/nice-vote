<!DOCTYPE html>
<html>
<head>
    <title>hello React</title>
    <meta charset="utf-8">
</head>
<body>
<div id="app">
    <!-- my app renders here -->
</div>
<script src="https://unpkg.com/react@15/dist/react.js"></script>
<script src="https://unpkg.com/react-dom@15/dist/react-dom.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.8.34/browser.js"></script>
<script type="text/babel">

const Vote = React.createClass({
  name: 'Vote',
  getInitialState : function() {
     return {
       items: this.props.items,
       newOpinion: "",
     };
  },
  vote: function(item) {
     item.num += 1;
     this.setState({
       items: this.state.items
     });
  },


  sumVotes: function(itemsToCount) {
    return Object.keys(itemsToCount).reduce(function(previous, key) {
      return previous + itemsToCount[key].num;
    }, 0);
  },

  add: function(e) {
    e.preventDefault();
    if (!this.state.newOpinion) {
      return;
    }
    this.state.items.push({
      title: this.state.newOpinion,
      num: 0
    });
    this.setState({
      items: this.state.items,
      newOpinion: ''
    });
  },

  editNewOpinion(e) {
    this.setState({
      newOpinion: e.target.value
    });
  },

  render: function() {
    return (
    <div>
      <h3>お題: {this.props.title}</h3>
      <p>現在{ this.state.items.length }つの候補があります。</p>
      <ul>{
        this.state.items.map(function(item, idx) {
          return (
           <li key={idx}>
             {item.title}
             <button key={idx} onClick={ev => this.vote(item)}>
             {item.num}
             </button>
           </li>
          )
        }, this)
      }</ul>
      <form onSubmit={this.add}>
        <input type="text"
               onChange={this.editNewOpinion}
               value={this.state.newOpinion}
               placeholder='意見'
        />
        <button disabled={!this.state.newOpinion}>追加</button>
      </form>
      <p>現在の総投票数は{ this.sumVotes(this.state.items) }票です。</p>
    </div>
    );
  }
});


ReactDOM.render(
  <Vote
     title='次の飲み会'
     items={[
       { title: '中華',   num: 0},
       { title: '焼肉',   num: 1},
       { title: 'チゲ鍋', num: 2}
     ]}
  >
  </Vote>,
  document.getElementById('app')
);

</script>
</body>
</html>